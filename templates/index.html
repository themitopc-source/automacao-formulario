\
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulário de Intervenção — Coleta</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
<div class="container">
  <h1>Formulário de Intervenção <small>— Coleta de Dados</small></h1>
  <p class="muted">Esta página apenas <b>salva</b> os dados para envio posterior na sua máquina. Nenhum dado é enviado ao Microsoft Forms.</p>

  <form id="f" onsubmit="return false;">
    <div class="grid">
      <label>Classificação<input name="classificacao" required></label>
      <label>Empresa<input name="empresa" value="Raízen" required></label>
      <label>Unidade<input name="unidade" value="Vale do Rosário" required></label>
      <label>Data<input name="data" placeholder="dd/mm/aaaa" required></label>
      <label>Hora><input name="hora" placeholder="08:00" required></label>
      <label>Turno<input name="turno" value="A" required></label>
      <label>Área<input name="area" value="Adm" required></label>
      <label>Setor<input name="setor" required></label>
      <label>Atividade<input name="atividade" required></label>
      <label>Intervenção<input name="intervencao" required></label>
      <label>CS<input name="cs" type="number" required></label>
      <label>Observação<input name="observacao" required></label>
      <label>Descrição<textarea name="descricao" required></textarea></label>
      <label>Fiz<textarea name="fiz" required></textarea></label>
    </div>
    <div class="actions">
      <button id="btn-send" onclick="submitForm()">Salvar</button>
      <div id="status" class="status hidden">
        <div class="spinner"></div>
        <span id="status-text">Enviando...</span>
      </div>
    </div>
  </form>

  <hr/>
  <div class="export">
    <h2>Exportar</h2>
    <p>Use para baixar os dados e rodar localmente o envio com seu Playwright.</p>
    <a class="btn" href="/export.json" target="_blank">Baixar JSON</a>
    <a class="btn" href="/export.csv" target="_blank">Baixar CSV</a>
  </div>
</div>

<script>
function allFilled(form){
  for (const el of form.elements){
    if (['INPUT','TEXTAREA','SELECT'].includes(el.tagName)){
      if (el.hasAttribute('required') && !el.value.trim()){
        el.focus();
        return false;
      }
    }
  }
  return true;
}
async function submitForm(){
  const form = document.getElementById('f');
  if(!allFilled(form)){
    alert('Preencha todos os campos obrigatórios.');
    return;
  }
  const fd = new FormData(form);
  const status = document.getElementById('status');
  const sttext = document.getElementById('status-text');
  status.classList.remove('hidden');
  sttext.textContent = 'Enviando...';

  try{
    const r = await fetch('/api/submit', {method:'POST', body: fd});
    const j = await r.json();
    if(j.ok){
      // simula envio ao Forms (somente UX)
      await new Promise(res => setTimeout(res, 1500));
      sttext.textContent = 'Enviado! (dados salvos)';
      setTimeout(()=>{ status.classList.add('hidden'); }, 1000);
      form.reset();
    }else{
      alert(j.detail || 'Erro ao salvar');
      status.classList.add('hidden');
    }
  }catch(e){
    alert('Falha de rede.');
    status.classList.add('hidden');
  }
}
</script>
</body>
</html>
